# 28. 테스트 경계
테스트는 시스템의 일부이다.
## 시스템 컴포넌트인 테스트
 - 테스트는 태생적으로 의존성 규칙을 따른다. 테스트는 아키텍처에서 가장 바깥쪽 원으로 생각할 수 있으며 시스템 내부의 어떤 것도 테스트에는 의존하지 않는다.  
 - 테스트는 독립적으로 배포 가능하다.
 - 테스트는 시스템 컴포넌트 중에서 가장 고립되어 있다. 

## 테스트를 고려한 설계
테스트가 지닌 특징때문에 개발자는 테스트가 시스템의 설계 범위 밖에 있다고 여기며, 이 관점은 치명적이다.  
테스트가 시스템의 설계와 잘 통합되지 않으면, 테스트는 깨지기 쉬워지고, 시스템은 뻣뻣해져서 변경하기가 어려워진다.  
문제는 결합이다. 시스템에 강하게 결합된 테스트라면 시스템이 변경될 때 함께 변경되어야만 한다. 시스템의 공통 컴포넌트가 변경되면 수백 수천개의 테스트가 망가진다. 이 문제는 깨지기 쉬운 테스트 문제(Fragile Tests Problem)로 알려져있다.  
시스템에 가한 간단한 변경이 대량의 테스트 실패로 이어진다는 사실을 알게 되면, 개발자는 그러한 변경을 하지 않으려 들것이다.  
이 문제를 해결하려면 테스트를 고려해서 설계해야만 한다.  
  
소프트웨어 설계의 첫 번째 규칙은 언제나 같다. **변동성이 있는 것에 의존하지 말라**  
GUI는 변동성이 크다. 시스템과 테스트를 설계할 때, GUI를 사용하지 않고 업무 규칙을 테스트할 수 있게 해야한다.  

## 테스트 API
테스트가 모든 업무 규칙을 검증하는 데 사용할 수 있도록 특화된 API를 만들자 이러한 API는 보안 제약사항을 무시할 수 있으며, (데이터베이스와 같은)값비싼 자원은 건너뛰고, 시스템을 테스트가능한 특정 상태로 강제하는 강력한 힘을 지녀야만 한다. 이 API는 사용자 인터페이스가 사용하는 인터렉터와 인터페이스 어댑터들의 상위 집합이 될 것이다.  
테스트 API는 테스트를 애플리케이션으로부터 분리할 목적으로 사용한다. 단순히 테스트를 UI에서 분리하는 것만이 아닌, 테스트 구조를 애플리케이션 구조로부터 결합을 분리하는 게 목표다.

## 구조적 결합
구조적 결합은 테스트 결합중에서 가장 강하며 가장 은밀하게 퍼져나가는 유형이다.  
상용클래스나 메서드 중 하나라도 변경되면 딸려 있는 다수의 테스트가 변경 되어야 한다.  
결과적으로 테스트는 꺠지기 쉬워지고 이로 인해 상용코드를 뻣뻣하게 만든다.  
테스트 API의 역활은 애플리케이션 구조를 테스트로 부터 숨기는데 있다.  
시간이 지날수록 테스트 코드는 더 구체적이고 더 특화된 형태로 변할것이고 상용 코드는 더 추상적이고 더 범용적인 형태로 변할 것이기 때문이다.

## 보안
테스트 API가 지닌 강력한 힘을 운영시스템에 배포하면 위험에 처할 수 있다.  
위험을 피할려면 독립적으로 배포할수 있는 컴포넌트로 분리 해야 한다.










































